# 协作指南

## 📁 工作区结构

每个工作流都会创建一个独立的工作区，结构如下：

```
workspaces/{workflow_name}/
├── {agent1_name}/          # Agent1 的专属工作目录
│   ├── .aider.chat.history.md    # Agent1 的对话历史
│   ├── .aider.input.history      # Agent1 的输入历史
│   └── [个人文件...]             # Agent1 的个人反思、草稿等
├── {agent2_name}/          # Agent2 的专属工作目录
│   └── ...
├── collab/                  # 共享协作目录 - 所有Agent都能访问
│   ├── [共享文件...]        # 交付物、共享文档等
│   └── [协作文件...]        # Agent间的文件传递
└── [其他文件...]
```

## 🔄 Agent 交互机制

### 基本原则
1. **每个状态只分配一个 Agent 执行任务**
2. **Agent 通过 `collab/` 目录传递文件和信息**
3. **前一个 Agent 的响应会传递给下一个 Agent**

### 交互流程
```
Agent A (状态1) → 执行任务 → 修改 collab/ + 个人目录 → 响应传递给 Agent B
Agent B (状态2) → 接收 Agent A 响应 → 查看 collab/ 文件 → 执行任务 → ...
```

## 📋 文件管理规范

### 🚫 严禁操作
- **不要直接读取其他 Agent 的个人目录**
- **不要删除或修改不属于自己的文件**
- **不要在共享目录存储临时文件**

### ✅ 推荐做法

#### 交付物管理
- **所有交付物都放在 `collab/` 目录**
- 文件命名要有意义，如 `requirements.md`, `design_spec.md`, `final_report.pdf`
- 如果有版本迭代，使用版本号：`ppt_v1.md`, `ppt_v2.md`

#### 个人文件管理
- **个人反思、草稿、临时文件放在自己的目录**
- 可以使用子目录组织：`reflections/`, `drafts/`, `notes/`
- 对话历史会自动保存在 `.aider.chat.history.md`

#### 文件传递规范
- 当前 Agent 的输出文件放在 `collab/` 目录
- 下一个 Agent 会自动获得访问权限
- 明确的文件命名约定便于后续 Agent 查找

## 💬 Agent 响应传递

### 响应结构
每个 Agent 的响应包含两个部分：

```json
{
  "content": "任务执行的详细说明和总结",
  "decisions": {
    "task_completed": true,
    "quality_score": 8,
    "next_action": "proceed"
  }
}
```

### 传递机制
- **content**: 会传递给下一个 Agent 作为上下文
- **decisions**: 用于状态机条件判断和全局状态更新
- **文件**: 通过 `collab/` 目录传递

## 🎯 协作最佳实践

### 明确职责分工
- 每个 Agent 都有明确的角色和职责
- 在 prompt 中明确说明当前 Agent 的任务范围
- 避免职责重叠和冲突

### 有效沟通
- 在 `collab/` 中放置清晰的状态报告
- 使用标准的文件格式和命名约定
- 提供详细的交接说明

### 质量控制
- 每个 Agent 都要检查前一个 Agent 的工作
- 在个人目录中记录发现的问题和建议
- 通过 decisions 字段表达对前一阶段的评价

## 🔧 技术实现细节

### 工作区初始化
- 工作流开始时自动创建完整的目录结构
- 每个 Agent 目录都有软链接指向 `collab/`
- Git 仓库会在需要时初始化

### 文件访问权限
- 所有 Agent 都能读取 `collab/` 中的所有文件
- Agent 只能写入自己的个人目录和 `collab/`
- 通过绝对路径确保文件访问的可靠性

### 状态持久化
- 工作区在工作流结束后会保留
- 可以手动清理或重用之前的执行结果
- 支持工作流的增量执行和调试

## 📋 快速参考版本

```
# 工作区交互指南
请严格遵循以下协作规则：
- 查看 `collab/` 目录了解前一个Agent的工作
- 将交付物放在 `collab/` 目录
- 在你的个人目录中记录反思和草稿
- 你的响应会传递给下一个Agent
---
```

---

*这个指南会被嵌入到每个 Agent 的 prompt 中，确保所有 Agent 都理解协作规则和交互机制。*
