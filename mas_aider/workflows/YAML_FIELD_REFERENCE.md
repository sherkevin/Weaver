# MAS-AIDER YAML å·¥ä½œæµé…ç½®æƒå¨æŠ€æœ¯è§„èŒƒ

æœ¬æ–‡æ¡£æä¾› MAS-AIDER å·¥ä½œæµ YAML é…ç½®çš„å®Œæ•´æŠ€æœ¯è§„èŒƒï¼Œæ·±å…¥è§£ææ¯ä¸ªå­—æ®µçš„æ ¸å¿ƒåŠŸèƒ½ã€ç³»ç»Ÿé›†æˆæ–¹å¼å’Œè®¾è®¡åŸç†ã€‚

## ğŸ“‹ ç›®å½•

1. [æ ¹çº§é…ç½®å­—æ®µè¯¦è§£](#æ ¹çº§é…ç½®å­—æ®µè¯¦è§£)
2. [Agent å®šä¹‰å­—æ®µè¯¦è§£](#agent-å®šä¹‰å­—æ®µè¯¦è§£)
3. [çŠ¶æ€æœºå­—æ®µè¯¦è§£](#çŠ¶æ€æœºå­—æ®µè¯¦è§£)
4. [å®Œæ•´æ•°æ®æµç¨‹å›¾](#å®Œæ•´æ•°æ®æµç¨‹å›¾)
5. [å­—æ®µç”Ÿå‘½å‘¨æœŸ](#å­—æ®µç”Ÿå‘½å‘¨æœŸ)

## ğŸ”§ æ ¹çº§é…ç½®å­—æ®µè¯¦è§£

### `name: "å·¥ä½œæµåç§°"`
- **æ ¸å¿ƒåŠŸèƒ½**: ä½œä¸ºå·¥ä½œæµçš„å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ”¯æŒå¤šå·¥ä½œæµå®ä¾‹åŒºåˆ†
- **ä¸ºä»€ä¹ˆè¦æœ‰**: åœ¨ç³»ç»Ÿä¸­åŒæ—¶è¿è¡Œå¤šä¸ªä¸åŒç±»å‹çš„å·¥ä½œæµæ—¶ï¼Œéœ€è¦å”¯ä¸€æ ‡è¯†æ¯ä¸ªå·¥ä½œæµå®ä¾‹
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œå¿…é¡»ç¬¦åˆæ–‡ä»¶åè§„èŒƒï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼‰
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `ConfigWorkflow.workflow_name` å±æ€§å­˜å‚¨ï¼Œå½±å“å·¥ä½œæµç±»å‹åˆ¤æ–­
  - å·¥ä½œåŒºç›®å½•ç»“æ„ç”Ÿæˆ: `EnvironmentService.setup_workspace_for_workflow(name, ...)` åˆ›å»º `workspaces/{name}/` ç›®å½•
  - é…ç½®æ–‡ä»¶è‡ªåŠ¨å®šä½: `ConfigWorkflow._find_config_file()` ä½¿ç”¨æ­¤åç§°æŸ¥æ‰¾ `workflows/{name}.yaml`
  - æ—¥å¿—ç³»ç»Ÿæ ‡è¯†: æ‰€æœ‰æ—¥å¿—è®°å½•éƒ½åŒ…å«å·¥ä½œæµåç§°ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
  - ç¼“å­˜å’ŒçŠ¶æ€ç®¡ç†: å·¥ä½œæµå®ä¾‹ç¼“å­˜ä½¿ç”¨æ­¤åç§°ä½œä¸ºé”®
- **ä½œç”¨æ—¶æœº**: å·¥ä½œæµå·¥å‚åˆ›å»ºé˜¶æ®µç«‹å³ä½¿ç”¨ï¼Œå½±å“æ•´ä¸ªå·¥ä½œæµç”Ÿå‘½å‘¨æœŸ
- **çº¦æŸæ¡ä»¶**: ä¸èƒ½é‡å¤ï¼Œä¸èƒ½ä¸ºç©ºï¼Œå¿…é¡»ç¬¦åˆæ–‡ä»¶ç³»ç»Ÿå‘½åè§„èŒƒ
- **æ•…éšœåœºæ™¯**: åç§°å†²çªä¼šå¯¼è‡´å·¥ä½œæµè¦†ç›–ï¼Œåç§°ç¼ºå¤±ä¼šä½¿ç”¨é»˜è®¤å€¼å½±å“è¯†åˆ«
- **è®¾è®¡è€ƒé‡**: æ”¯æŒå·¥ä½œæµç‰ˆæœ¬æ§åˆ¶ï¼Œå¦‚ `code_review_v2`, `content_creation_beta`
- **æœ€ä½³å®è·µ**: ä½¿ç”¨ç®€æ´æœ‰æ„ä¹‰çš„è‹±æ–‡åç§°ï¼Œä½“ç°å·¥ä½œæµæ ¸å¿ƒåŠŸèƒ½

### `description: "å·¥ä½œæµæè¿°"`
- **æ ¸å¿ƒåŠŸèƒ½**: æä¾›å·¥ä½œæµçš„è¯¦ç»†åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æŒ‡å—
- **ä¸ºä»€ä¹ˆè¦æœ‰**: å¸®åŠ©å¼€å‘è€…ç†è§£å·¥ä½œæµç”¨é€”ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆå’Œç”¨æˆ·ç•Œé¢å±•ç¤º
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œæ”¯æŒå¤šè¡Œæ–‡æœ¬å’Œ Markdown æ ¼å¼
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `ConfigWorkflow.get_config_summary()` API æ–¹æ³•è¿”å›ï¼Œä¾›å¤–éƒ¨ç³»ç»ŸæŸ¥è¯¢
  - å‘½ä»¤è¡Œç•Œé¢: `mas_aider --list` å‘½ä»¤å±•ç¤ºæ‰€æœ‰å·¥ä½œæµæè¿°
  - æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ: ç³»ç»Ÿå¯ä»¥åŸºäºæè¿°ç”Ÿæˆç”¨æˆ·æ‰‹å†Œå’Œ API æ–‡æ¡£
  - è°ƒè¯•å’Œç›‘æ§: å·¥ä½œæµè¯¦æƒ…é¡µé¢å’Œå·¥ä½œæµçŠ¶æ€é¢æ¿æ˜¾ç¤ºæè¿°ä¿¡æ¯
  - å®¡è®¡æ—¥å¿—: å·¥ä½œæµæ‰§è¡Œè®°å½•åŒ…å«æè¿°ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- **ä½œç”¨æ—¶æœº**: é…ç½®åŠ è½½å®Œæˆåï¼Œä»»ä½•éœ€è¦å±•ç¤ºå·¥ä½œæµå…ƒä¿¡æ¯æ—¶éƒ½ä¼šä½¿ç”¨
- **çº¦æŸæ¡ä»¶**: å»ºè®®é•¿åº¦ 50-200 å­—ç¬¦ï¼ŒåŒ…å«æ ¸å¿ƒä»·å€¼ä¸»å¼ å’Œä½¿ç”¨åœºæ™¯
- **æ•…éšœåœºæ™¯**: æè¿°ç¼ºå¤±ä¼šå¯¼è‡´ç”¨æˆ·ç•Œé¢ä¸å‹å¥½ï¼Œå‘½ä»¤è¡Œåˆ—è¡¨éš¾ä»¥ç†è§£
- **è®¾è®¡è€ƒé‡**: åº”è¯¥åŒ…å«å·¥ä½œæµçš„è¾“å…¥ã€è¾“å‡ºã€é€‚ç”¨åœºæ™¯å’Œé™åˆ¶æ¡ä»¶
- **æœ€ä½³å®è·µ**: ä½¿ç”¨ä¸»åŠ¨è¯­æ€ï¼Œçªå‡ºå·¥ä½œæµèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜

### `initial_message: "å·¥ä½œæµä»»åŠ¡ç›®æ ‡"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰æ•´ä¸ªå·¥ä½œæµçš„æ€»ä½“ä»»åŠ¡ç›®æ ‡ï¼Œä¸ºæ‰€æœ‰çŠ¶æ€æä¾›ä¸€è‡´çš„ä¸Šä¸‹æ–‡
- **ä¸ºä»€ä¹ˆè¦æœ‰**: ç¡®ä¿æ‰€æœ‰æ‰§è¡ŒçŠ¶æ€çš„ Agent éƒ½ç†è§£å·¥ä½œæµçš„æ•´ä½“ç›®æ ‡ï¼Œé¿å…çŠ¶æ€é—´ä¸Šä¸‹æ–‡æ–­è£‚
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œæ”¯æŒç®€å•çš„æ–‡æœ¬æè¿°
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `WorkflowFactory.get_workflow_initial_message()` æ–¹æ³•è·å–é…ç½®å€¼
  - `WorkflowContext.initial_message` å±æ€§å­˜å‚¨ï¼Œè´¯ç©¿æ•´ä¸ªå·¥ä½œæµæ‰§è¡Œ
  - `StateMachineEngine._render_prompt()` æ¨¡æ¿å¼•æ“è¿›è¡ŒåŠ¨æ€æ›¿æ¢
  - æ‰€æœ‰çŠ¶æ€çš„ Agent prompt é€šè¿‡ `{{initial_message}}` æ¨¡æ¿å˜é‡åµŒå…¥
  - å·¥ä½œæµæ‰§è¡Œå†å²è®°å½•åˆå§‹ä»»åŠ¡ç›®æ ‡ï¼Œä¾¿äºç»“æœåˆ†æ
- **ä½œç”¨æ—¶æœº**: æ¯ä¸ªçŠ¶æ€æ‰§è¡Œå‰ï¼Œprompt æ¸²æŸ“é˜¶æ®µåŠ¨æ€åµŒå…¥ä¸Šä¸‹æ–‡
- **çº¦æŸæ¡ä»¶**: åº”è¯¥èšç„¦æ ¸å¿ƒä»»åŠ¡ï¼Œé¿å…ä¸å…·ä½“çŠ¶æ€æŒ‡ä»¤å†²çªï¼›é•¿åº¦é€‚ä¸­
- **æ•…éšœåœºæ™¯**: æè¿°è¿‡æ³›ä¼šå¯¼è‡´ Agent ç†è§£åå·®ï¼Œè¿‡äºå…·ä½“ä¼šé™åˆ¶çŠ¶æ€çµæ´»æ€§
- **è®¾è®¡è€ƒé‡**: ä½œä¸ºå·¥ä½œæµçš„"åŒ—ææ˜Ÿ"ï¼Œç¡®ä¿æ‰€æœ‰ Agent è¡ŒåŠ¨ä¸€è‡´æ€§
- **æœ€ä½³å®è·µ**: æè¿°æœ€ç»ˆäº¤ä»˜ç‰©å’Œæ ¸å¿ƒä»·å€¼ï¼Œå¦‚"åˆ›å»ºä¸€ä¸ªå¸å¼•äººçš„äº§å“å‘å¸ƒä¼šPPT"

### `max_turns: æ•°å­—`
- **æ ¸å¿ƒåŠŸèƒ½**: è®¾ç½®å·¥ä½œæµæ‰§è¡Œçš„æœ€å¤§è½®æ¬¡ä¸Šé™ï¼Œé˜²æ­¢æ— é™å¾ªç¯å’Œèµ„æºæµªè´¹
- **ä¸ºä»€ä¹ˆè¦æœ‰**: å·¥ä½œæµå¯èƒ½å› é€»è¾‘é”™è¯¯æˆ–æ¡ä»¶æ°¸è¿œä¸æ»¡è¶³è€Œé™·å…¥æ­»å¾ªç¯ï¼Œéœ€è¦å®‰å…¨ä¿éšœ
- **æ•°æ®ç±»å‹**: æ­£æ•´æ•°ï¼Œé»˜è®¤å€¼ 10ï¼Œå»ºè®®èŒƒå›´ 3-20
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine.__init__()` åˆå§‹åŒ–æ‰§è¡Œå¼•æ“çš„å¾ªç¯é™åˆ¶
  - `ConditionEvaluator` æ³¨å†Œå…¨å±€å˜é‡ `max_turns` ä¾›æ¡ä»¶è¡¨è¾¾å¼ä½¿ç”¨
  - å…¨å±€é€€å‡ºæ¡ä»¶è‡ªåŠ¨åŒ…å«: `"turn_count >= max_turns"` çš„æ£€æŸ¥é€»è¾‘
  - æ‰§è¡Œç›‘æ§ç³»ç»Ÿè®°å½•è½®æ¬¡ä½¿ç”¨æƒ…å†µï¼Œç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
  - è¶…æ—¶å‘Šè­¦æœºåˆ¶åœ¨æ¥è¿‘ä¸Šé™æ—¶å‘å‡ºè­¦å‘Š
- **ä½œç”¨æ—¶æœº**: æ¯æ¬¡çŠ¶æ€å¾ªç¯å¼€å§‹å‰å¼ºåˆ¶æ£€æŸ¥ï¼Œä¼˜å…ˆçº§æœ€é«˜
- **çº¦æŸæ¡ä»¶**: æ ¹æ®å·¥ä½œæµçŠ¶æ€æ•°é‡è®¾ç½®ï¼Œé€šå¸¸ä¸ºçŠ¶æ€æ•°çš„ 2-3 å€
- **æ•…éšœåœºæ™¯**: è®¾ç½®è¿‡å°ä¼šæå‰ç»ˆæ­¢æœ‰æ•ˆå·¥ä½œæµï¼Œè¿‡å¤§ä¼šé€ æˆèµ„æºæµªè´¹
- **è®¾è®¡è€ƒé‡**: å¹³è¡¡ç”¨æˆ·éœ€æ±‚å¤æ‚åº¦å’Œç³»ç»Ÿèµ„æºæ¶ˆè€—
- **æœ€ä½³å®è·µ**: ä»ç®€å•åœºæ™¯æµ‹è¯•å¼€å§‹ï¼Œé€æ­¥è°ƒæ•´åˆ°åˆé€‚å€¼

## ğŸ‘¥ Agent å®šä¹‰å­—æ®µè¯¦è§£

### `agents` æ•°ç»„

#### `agents[].name: "Agentåç§°"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰ç³»ç»Ÿä¸­å¯ç”¨çš„ Agent å®ä¾‹çš„å”¯ä¸€æ ‡è¯†ç¬¦
- **ä¸ºä»€ä¹ˆè¦æœ‰**: å·¥ä½œæµéœ€è¦çŸ¥é“æœ‰å“ªäº› Agent å¯ç”¨ï¼Œä»¥åŠå¦‚ä½•å¼•ç”¨å®ƒä»¬
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œåœ¨åŒä¸€ä¸ªå·¥ä½œæµä¸­å¿…é¡»å”¯ä¸€
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `ConfigWorkflow.get_agent_configs()` è¿”å›æ ‡å‡†åŒ–çš„ Agent é…ç½®åˆ—è¡¨
  - `BaseWorkflow.execute()` ä½¿ç”¨æ­¤åç§°åˆ›å»ºå¯¹åº”çš„ Agent å®ä¾‹
  - `EnvironmentService.setup_workspace_for_workflow()` ä¸ºæ¯ä¸ª Agent åˆ›å»ºä¸“å±ç›®å½•
  - çŠ¶æ€é…ç½®éªŒè¯: æ‰€æœ‰ `states[].agent` å­—æ®µå¿…é¡»åœ¨æ­¤åˆ—è¡¨ä¸­å­˜åœ¨
  - Agent æœåŠ¡æ˜ å°„: `AgentService.create_agents_for_workflow()` ä½¿ç”¨æ­¤åç§°åŒ¹é… Agent å·¥å‚
- **ä½œç”¨æ—¶æœº**: å·¥ä½œæµåˆå§‹åŒ–é˜¶æ®µï¼ŒAgent åˆ›å»ºå‰è¿›è¡Œé…ç½®éªŒè¯
- **çº¦æŸæ¡ä»¶**: ä¸èƒ½é‡å¤ï¼Œä¸èƒ½ä¸ºç©ºï¼Œåªèƒ½ä½¿ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- **æ•…éšœåœºæ™¯**: åç§°ä¸å­˜åœ¨ä¼šå¯¼è‡´çŠ¶æ€æ‰§è¡Œå¤±è´¥ï¼Œåç§°é‡å¤ä¼šé€ æˆé…ç½®å†²çª
- **è®¾è®¡è€ƒé‡**: åº”è¯¥ä½“ç° Agent çš„åŠŸèƒ½è§’è‰²ï¼Œå¦‚ "architect", "reviewer"
- **æœ€ä½³å®è·µ**: ä½¿ç”¨åè¯å½¢å¼ï¼Œæ¸…æ™°è¡¨è¾¾ Agent çš„èŒè´£

#### `agents[].type: "Agentç±»å‹"`
- **æ ¸å¿ƒåŠŸèƒ½**: æŒ‡å®š Agent çš„æŠ€æœ¯å®ç°ç±»å‹ï¼Œç”¨äºé€‰æ‹©ä¸åŒçš„ Coder ç±»
- **ä¸ºä»€ä¹ˆè¦æœ‰**: ä¸åŒç±»å‹çš„ Agent æœ‰ä¸åŒçš„èƒ½åŠ›å’Œè¡Œä¸ºï¼ˆå¦‚ ArchitectCoder æ“…é•¿æ¶æ„è®¾è®¡ï¼‰
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œå¿…é¡»æ˜¯é¢„å®šä¹‰çš„ç±»å‹å€¼
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `AiderAgentFactory.create_coder()` ä½¿ç”¨ `CODER_TYPES` æ˜ å°„é€‰æ‹© Coder ç±»
  - `AgentService.get_agent()` ä¼ é€’ type å‚æ•°ç»™å·¥å‚æ–¹æ³•
  - `ConfigWorkflow.get_agent_configs()` è¿”å›çš„é…ç½®å¯¹è±¡ä¸­åŒ…å«ç±»å‹ä¿¡æ¯
  - Agent å®ä¾‹åˆ›å»ºæ—¶æ ¹æ® type é€‰æ‹©å¯¹åº”çš„ Coder å®ç°
- **ä½œç”¨æ—¶æœº**: Agent å®ä¾‹åˆ›å»ºæ—¶ï¼Œç”¨äºé€‰æ‹©æ­£ç¡®çš„ Coder ç±»
- **çº¦æŸæ¡ä»¶**: å¿…é¡»æ˜¯æœ‰æ•ˆç±»å‹: "coder", "architect", "ask"
- **é»˜è®¤å€¼**: å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸º "coder"
- **æ•…éšœåœºæ™¯**: æ— æ•ˆç±»å‹ä¼šå¯¼è‡´ä½¿ç”¨é»˜è®¤çš„ Coder ç±»
- **è®¾è®¡è€ƒé‡**: type æ˜¯æŠ€æœ¯å®ç°å±‚é¢çš„é€‰æ‹©ï¼Œä¸ä¸šåŠ¡è§’è‰²ï¼ˆåœ¨ prompt ä¸­å®šä¹‰ï¼‰åˆ†ç¦»
- **æœ€ä½³å®è·µ**: 
  - éœ€è¦æ¶æ„è®¾è®¡èƒ½åŠ›æ—¶ä½¿ç”¨ "architect"
  - éœ€è¦é—®ç­”èƒ½åŠ›æ—¶ä½¿ç”¨ "ask"
  - ä¸€èˆ¬ä»£ç ç¼–å†™ä½¿ç”¨ "coder"ï¼ˆé»˜è®¤ï¼‰

## ğŸ”„ çŠ¶æ€æœºå­—æ®µè¯¦è§£

### `states` æ•°ç»„

#### `states[].name: "çŠ¶æ€åç§°"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰å·¥ä½œæµä¸­æ¯ä¸ªæ‰§è¡Œæ­¥éª¤çš„å”¯ä¸€æ ‡è¯†ç¬¦
- **ä¸ºä»€ä¹ˆè¦æœ‰**: çŠ¶æ€æœºéœ€è¦ç²¾ç¡®çŸ¥é“æ¯ä¸ªçŠ¶æ€çš„èº«ä»½ï¼Œä»¥ä¾¿çŠ¶æ€è½¬ç§»å’Œæ—¥å¿—è®°å½•
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œåœ¨åŒä¸€ä¸ªå·¥ä½œæµä¸­å¿…é¡»å”¯ä¸€
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine.__init__()` æ„å»º `state_map` å­—å…¸ï¼Œé”®ä¸ºçŠ¶æ€åç§°
  - `StateMachineEngine._evaluate_transitions()` ä½¿ç”¨åç§°åŒ¹é…è½¬ç§»ç›®æ ‡
  - `StateMachineEngine._execute_agent_task()` è®°å½•å½“å‰æ‰§è¡ŒçŠ¶æ€
  - æ—¥å¿—ç³»ç»Ÿ: æ‰€æœ‰æ‰§è¡Œæ—¥å¿—éƒ½åŒ…å«çŠ¶æ€åç§°ï¼Œä¾¿äºé—®é¢˜å®šä½
  - è°ƒè¯•ç•Œé¢: å·¥ä½œæµæ‰§è¡Œè¿›åº¦æ˜¾ç¤ºå½“å‰çŠ¶æ€åç§°
- **ä½œç”¨æ—¶æœº**: çŠ¶æ€æœºåˆå§‹åŒ–æ—¶æ„å»ºæ˜ å°„è¡¨ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æŒç»­ä½¿ç”¨
- **çº¦æŸæ¡ä»¶**: ä¸èƒ½é‡å¤ï¼Œä¸èƒ½ä¸ºç©ºï¼Œå»ºè®®ä½¿ç”¨ snake_case å‘½å
- **æ•…éšœåœºæ™¯**: åç§°ä¸å­˜åœ¨ä¼šå¯¼è‡´è½¬ç§»å¤±è´¥ï¼Œåç§°é‡å¤ä¼šé€ æˆæ˜ å°„å†²çª
- **è®¾è®¡è€ƒé‡**: åº”è¯¥ä½“ç°çŠ¶æ€çš„æ ¸å¿ƒåŠ¨ä½œï¼Œå¦‚ "requirement_analysis", "code_review"
- **æœ€ä½³å®è·µ**: ä½¿ç”¨åŠ¨å®¾ç»“æ„ï¼Œæ¸…æ™°è¡¨è¾¾çŠ¶æ€ç›®çš„

#### `states[].agent: "æ‰§è¡ŒAgent"`
- **æ ¸å¿ƒåŠŸèƒ½**: æŒ‡å®šå“ªä¸ª Agent è´Ÿè´£æ‰§è¡Œæ­¤çŠ¶æ€çš„ä»»åŠ¡
- **ä¸ºä»€ä¹ˆè¦æœ‰**: å·¥ä½œæµä¸­çš„ä¸åŒä»»åŠ¡éœ€è¦ä¸åŒèƒ½åŠ›çš„ Agent æ¥æ‰§è¡Œ
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œå¿…é¡»åœ¨æ ¹çº§çš„ `agents` æ•°ç»„ä¸­å­˜åœ¨
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._execute_agent_task()` ä½¿ç”¨æ­¤å­—æ®µè·å– Agent å®ä¾‹
  - `AgentService.get_agent_for_workflow()` é€šè¿‡ agent åç§°æŸ¥æ‰¾å¯¹åº”çš„ Agent
  - é…ç½®éªŒè¯: `ConfigWorkflow._validate_config()` æ£€æŸ¥ agent æ˜¯å¦å­˜åœ¨
  - å·¥ä½œåŒºæ˜ å°„: Agent åç§°å†³å®šä½¿ç”¨å“ªä¸ªå·¥ä½œç›®å½•
  - æƒé™æ§åˆ¶: å°†æ¥å¯èƒ½åŸºäº agent è§’è‰²è¿›è¡Œè®¿é—®æ§åˆ¶
- **ä½œç”¨æ—¶æœº**: æ¯ä¸ªçŠ¶æ€æ‰§è¡Œå‰ç¡®å®šæ‰§è¡Œè€…
- **çº¦æŸæ¡ä»¶**: å¿…é¡»æ˜¯å·²å®šä¹‰çš„ agent åç§°ï¼Œå¤§å°å†™æ•æ„Ÿ
- **æ•…éšœåœºæ™¯**: agent ä¸å­˜åœ¨ä¼šå¯¼è‡´çŠ¶æ€æ‰§è¡Œå¤±è´¥
- **è®¾è®¡è€ƒé‡**: åº”è¯¥åŸºäºä»»åŠ¡æ€§è´¨é€‰æ‹©åˆé€‚çš„ agent
- **æœ€ä½³å®è·µ**: æ¯ä¸ªçŠ¶æ€åªæŒ‡å®šä¸€ä¸ª agentï¼Œé¿å…è´£ä»»ä¸æ¸…

#### `states[].start: true/false`
- **æ ¸å¿ƒåŠŸèƒ½**: æ ‡è®°å·¥ä½œæµçš„èµ·å§‹æ‰§è¡ŒçŠ¶æ€
- **ä¸ºä»€ä¹ˆè¦æœ‰**: çŠ¶æ€æœºéœ€è¦çŸ¥é“ä»å“ªé‡Œå¼€å§‹æ‰§è¡Œå·¥ä½œæµ
- **æ•°æ®ç±»å‹**: å¸ƒå°”å€¼ï¼Œåªæœ‰ä¸€ä¸ªçŠ¶æ€å¯ä»¥ä¸º true
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._get_start_state()` éå†æ‰€æœ‰çŠ¶æ€æŸ¥æ‰¾ `start: true`
  - `StateMachineEngine.execute()` ä½¿ç”¨æ‰¾åˆ°çš„èµ·å§‹çŠ¶æ€å¼€å§‹æ‰§è¡Œ
  - é…ç½®éªŒè¯: `ConfigWorkflow._validate_config()` ç¡®ä¿åªæœ‰ä¸€ä¸ªèµ·å§‹çŠ¶æ€
  - æ‰§è¡Œè¿½è¸ª: èµ·å§‹çŠ¶æ€è®°å½•åœ¨å·¥ä½œæµæ‰§è¡Œå†å²ä¸­
- **ä½œç”¨æ—¶æœº**: å·¥ä½œæµå¼€å§‹æ‰§è¡Œå‰çš„ä¸€æ¬¡æ€§æŸ¥æ‰¾
- **çº¦æŸæ¡ä»¶**: æ•´ä¸ªå·¥ä½œæµä¸­åªèƒ½æœ‰ä¸€ä¸ªçŠ¶æ€è®¾ç½®ä¸º true
- **æ•…éšœåœºæ™¯**: æ²¡æœ‰èµ·å§‹çŠ¶æ€ä¼šå¯¼è‡´æ‰§è¡Œå¤±è´¥ï¼Œå¤šä¸ªèµ·å§‹çŠ¶æ€ä¼šé€ æˆä¸ç¡®å®šæ€§
- **è®¾è®¡è€ƒé‡**: èµ·å§‹çŠ¶æ€åº”è¯¥æ˜¯éœ€æ±‚è¾“å…¥æˆ–ä»»åŠ¡åˆå§‹åŒ–çš„çŠ¶æ€
- **æœ€ä½³å®è·µ**: é€šå¸¸æ˜¯ç”¨æˆ·è¾“å…¥éœ€æ±‚çš„ç¬¬ä¸€ä¸ªçŠ¶æ€

#### `states[].prompt: "ä»»åŠ¡æŒ‡ä»¤"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰å‘é€ç»™ Agent çš„å…·ä½“ä»»åŠ¡æŒ‡ä»¤å’Œä¸Šä¸‹æ–‡ä¿¡æ¯
- **ä¸ºä»€ä¹ˆè¦æœ‰**: Agent éœ€è¦è¯¦ç»†çš„æŒ‡ä»¤æ‰èƒ½æ­£ç¡®æ‰§è¡Œä»»åŠ¡
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._execute_agent_task()` è·å–åŸå§‹ prompt å­—ç¬¦ä¸²
  - `StateMachineEngine._render_prompt()` æ‰§è¡Œæ¨¡æ¿å˜é‡æ›¿æ¢
  - Agent æœåŠ¡æ¥æ”¶æ¸²æŸ“åçš„å®Œæ•´æŒ‡ä»¤
  - æ‰§è¡Œå†å²è®°å½•å®Œæ•´çš„ prompt å†…å®¹ï¼Œä¾¿äºè°ƒè¯•
- **ä½œç”¨æ—¶æœº**: æ¯ä¸ªçŠ¶æ€æ‰§è¡Œå‰è¿›è¡Œæ¸²æŸ“ï¼Œå®æ—¶å‘é€ç»™ Agent
- **æ”¯æŒçš„æ¨¡æ¿å˜é‡**:
  - `{{initial_message}}`: å·¥ä½œæµåˆå§‹ä»»åŠ¡ç›®æ ‡
  - `{{turn_count}}`: å½“å‰æ‰§è¡Œè½®æ¬¡
  - `{{COLLABORATION_GUIDE}}`: åä½œè§„èŒƒå¸¸é‡ï¼Œä» workspace_interaction_guide.py åŠ è½½çš„å­—ç¬¦ä¸²å¸¸é‡
  - `{{last_agent_name}}`: å‰ä¸€ä¸ªå‚ä¸è€…çš„åç§°ï¼ˆå¢é‡ä¿¡æ¯/æ¥åŠ›æ£’ï¼‰ï¼Œä» global_state["agent_responses"][-1]["agent"] è·å–ï¼Œè‹¥æ— åˆ™ä¸ºç©ºå­—ç¬¦ä¸²
  - `{{last_agent_content}}`: å‰ä¸€ä¸ªå‚ä¸è€…ä¸Šä¸€è½®çš„å“åº”å†…å®¹ï¼ˆå¢é‡ä¿¡æ¯/æ¥åŠ›æ£’ï¼‰ï¼Œä» global_state["agent_responses"][-1]["response"]["content"] è·å–ï¼Œè‹¥æ— åˆ™ä¸ºç©ºå­—ç¬¦ä¸²
  - `{{last_agent_decisions}}`: å‰ä¸€ä¸ªå‚ä¸è€…ä¸Šä¸€è½®çš„å†³ç­–ç»“æœï¼ˆå¢é‡ä¿¡æ¯/æ¥åŠ›æ£’ï¼‰ï¼Œä» global_state["agent_responses"][-1]["response"]["decisions"] è·å–å¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè‹¥æ— åˆ™ä¸º "{}"

**é‡è¦è®¾è®¡åŸåˆ™**ï¼š
- `{{last_*}}` å˜é‡åªä¼ é€’**å¢é‡ä¿¡æ¯**ï¼ˆä¸Šä¸€è½®å¯¹æ–¹åˆšåˆšè¯´çš„é‚£ä¸€å¥è¯ï¼‰ï¼Œä¸æ˜¯å®Œæ•´å†å²
- è¯¦ç»†å†å²ç”± Aider è‡ªåŠ¨ç®¡ç†ï¼ˆé€šè¿‡ `cur_messages` å’Œ `done_messages`ï¼‰
- æ–‡ä»¶å˜åŒ–ç”± Aider è‡ªåŠ¨æ„ŸçŸ¥ï¼ˆé€šè¿‡ `fnames` å’Œ `RepoMap`ï¼‰
- è¿™æ ·è®¾è®¡å¯ä»¥é¿å…ä¸Šä¸‹æ–‡çˆ†ç‚¸ï¼ŒåŒæ—¶å……åˆ†åˆ©ç”¨ Aider çš„ä¸Šä¸‹æ–‡ç®¡ç†èƒ½åŠ›

è¿™äº›å˜é‡åœ¨ prompt æ¸²æŸ“æ—¶åŠ¨æ€æ›¿æ¢ï¼Œç¡®ä¿å‚ä¸è€…äº†è§£ä¸Šä¸‹æ–‡å’Œåä½œè§„åˆ™ã€‚{{COLLABORATION_GUIDE}} æä¾›ç»Ÿä¸€çš„åä½œè§„èŒƒï¼Œ{{last_*}} å˜é‡æä¾›ä¸Šä¸€è½®æ‰§è¡Œçš„åé¦ˆå’Œå†³ç­–ä¿¡æ¯ï¼ˆå¢é‡ä¿¡æ¯ï¼‰ã€‚
- **æ•…éšœåœºæ™¯**: æ¨¡æ¿å˜é‡ä¸å­˜åœ¨ä¼šå¯¼è‡´æ¸²æŸ“å¤±è´¥ï¼ŒAgent æ”¶åˆ°ä¸å®Œæ•´çš„æŒ‡ä»¤
- **è®¾è®¡è€ƒé‡**: æ¨¡æ¿åŒ–æ”¯æŒåŠ¨æ€ä¸Šä¸‹æ–‡ï¼Œæé«˜æŒ‡ä»¤çš„é€‚åº”æ€§
- **æœ€ä½³å®è·µ**: æ¸…æ™°æè¿°ä»»åŠ¡ç›®æ ‡ã€æ‰§è¡Œæ­¥éª¤ã€è¾“å‡ºæ ¼å¼å’Œå†³ç­–æ ‡å‡†

### çŠ¶æ€è½¬ç§»é…ç½®

#### `states[].transitions` æ•°ç»„

##### `transitions[].to: "ç›®æ ‡çŠ¶æ€"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰çŠ¶æ€æ‰§è¡ŒæˆåŠŸåçš„ä¸‹ä¸€ä¸ªæ‰§è¡ŒçŠ¶æ€
- **ä¸ºä»€ä¹ˆè¦æœ‰**: æ§åˆ¶å·¥ä½œæµçš„çŠ¶æ€æµè½¬é€»è¾‘ï¼Œå®ç°æ¡ä»¶åˆ†æ”¯
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œå¿…é¡»æ˜¯æœ‰æ•ˆçŠ¶æ€åæˆ–ç‰¹æ®Šå€¼ "END"
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._evaluate_transitions()` è¿”å›åŒ¹é…çš„è½¬ç§»ç›®æ ‡
  - `StateMachineEngine.execute()` æ›´æ–° `global_state["current_state"]`
  - çŠ¶æ€éªŒè¯: `ConfigWorkflow._validate_config()` æ£€æŸ¥ç›®æ ‡çŠ¶æ€æ˜¯å¦å­˜åœ¨
  - æ‰§è¡Œè¿½è¸ª: è½¬ç§»å†å²è®°å½•åœ¨ `global_state["execution_history"]` ä¸­
- **ä½œç”¨æ—¶æœº**: Agent å“åº”è§£æåï¼Œæ¡ä»¶è¯„ä¼°æˆåŠŸæ—¶ç«‹å³æ‰§è¡Œè½¬ç§»
- **çº¦æŸæ¡ä»¶**: å¿…é¡»æŒ‡å‘å­˜åœ¨çš„çŠ¶æ€åï¼Œæˆ–ä½¿ç”¨ "END" ç»“æŸå·¥ä½œæµ
- **æ•…éšœåœºæ™¯**: ç›®æ ‡çŠ¶æ€ä¸å­˜åœ¨ä¼šå¯¼è‡´æ‰§è¡Œä¸­æ–­
- **è®¾è®¡è€ƒé‡**: æ”¯æŒå·¥ä½œæµçš„æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯é€»è¾‘
- **æœ€ä½³å®è·µ**: ä½¿ç”¨æè¿°æ€§åç§°ï¼Œæ¸…æ™°è¡¨è¾¾è½¬ç§»çš„ç›®çš„

##### `transitions[].condition: "è½¬ç§»æ¡ä»¶"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰çŠ¶æ€è½¬ç§»çš„è§¦å‘æ¡ä»¶ï¼Œå®ç°æ™ºèƒ½è·¯ç”±
- **ä¸ºä»€ä¹ˆè¦æœ‰**: æ ¹æ® Agent æ‰§è¡Œç»“æœåŠ¨æ€å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._evaluate_transitions()` æŒ‰é¡ºåºè¯„ä¼°æ¯ä¸ªè½¬ç§»æ¡ä»¶
  - `ConditionEvaluator.evaluate()` æ‰§è¡Œè¡¨è¾¾å¼è§£æå’Œè®¡ç®—
  - Agent å“åº”è§£æå™¨æå– `decisions` å­—æ®µä½œä¸ºæ¡ä»¶å˜é‡
  - å…¨å±€çŠ¶æ€ç®¡ç†å™¨æä¾› `turn_count`, `max_turns` ç­‰å˜é‡
- **ä½œç”¨æ—¶æœº**: Agent å“åº”è§£æå®Œæˆåç«‹å³è¯„ä¼°
- **æ”¯æŒçš„æ¡ä»¶è¯­æ³•**:
  - **å¸ƒå°”å­—é¢é‡**: `"true"`, `"false"` - ç›´æ¥æ§åˆ¶è½¬ç§»
  - **Agent decisions**: `"needs_more_info"`, `"content_complete"` - åŸºäº Agent åˆ¤æ–­
  - **å…¨å±€çŠ¶æ€**: `"turn_count >= 6"` - åŸºäºæ‰§è¡Œè½®æ¬¡
  - **å¤åˆæ¡ä»¶**: `"needs_revision and satisfaction_score < 8"` - å¤šæ¡ä»¶ç»„åˆ
  - **æ•°å€¼æ¯”è¾ƒ**: `"quality_score >= 8"` - è´¨é‡è¯„ä¼°
- **æ•…éšœåœºæ™¯**: è¡¨è¾¾å¼è¯­æ³•é”™è¯¯ä¼šå¯¼è‡´è¯„ä¼°å¤±è´¥ï¼Œæ¡ä»¶æ°¸è¿œä¸æ»¡è¶³ä¼šé€ æˆæ­»å¾ªç¯
- **è®¾è®¡è€ƒé‡**: æä¾›å£°æ˜å¼çš„å·¥ä½œæµæ§åˆ¶é€»è¾‘ï¼Œæ— éœ€ç¼–å†™ä»£ç 
- **æœ€ä½³å®è·µ**: ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åï¼Œæ¡ä»¶åº”è¯¥äº’æ–¥é¿å…å†²çª

### å…¨å±€é€€å‡ºæ¡ä»¶

#### `exit_conditions` æ•°ç»„

##### `exit_conditions[].condition: "é€€å‡ºæ¡ä»¶"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰å·¥ä½œæµçš„å…¨å±€ç»ˆæ­¢æ¡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºæ™®é€šçŠ¶æ€è½¬ç§»
- **ä¸ºä»€ä¹ˆè¦æœ‰**: æä¾›å®‰å…¨ä¿éšœï¼Œé˜²æ­¢å·¥ä½œæµå› å¼‚å¸¸æƒ…å†µæ— é™æ‰§è¡Œ
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œå¸ƒå°”è¡¨è¾¾å¼ï¼ŒåŒè½¬ç§»æ¡ä»¶è¯­æ³•
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._check_global_exit_conditions()` åœ¨æ¯æ¬¡å¾ªç¯å¼€å§‹æ—¶æ£€æŸ¥
  - `ConditionEvaluator` ä½¿ç”¨ç›¸åŒçš„è¡¨è¾¾å¼å¼•æ“è¯„ä¼°æ¡ä»¶
  - æ‰§è¡Œç›‘æ§ç³»ç»Ÿè®°å½•é€€å‡ºåŸå› å’Œæ—¶æœº
  - å·¥ä½œæµæŠ¥å‘Šç”Ÿæˆé€€å‡ºç»Ÿè®¡ä¿¡æ¯
- **ä½œç”¨æ—¶æœº**: æ¯ä¸ªçŠ¶æ€å¾ªç¯å¼€å§‹å‰å¼ºåˆ¶æ£€æŸ¥ï¼Œæœ€é«˜ä¼˜å…ˆçº§
- **å¸¸è§é€€å‡ºæ¡ä»¶**:
  - `"turn_count >= max_turns"` - è½®æ¬¡è¶…é™
  - `"error_occurred"` - æ‰§è¡Œé”™è¯¯
  - `"timeout_exceeded"` - æ‰§è¡Œè¶…æ—¶
- **æ•…éšœåœºæ™¯**: æ¡ä»¶è®¾ç½®è¿‡æ¾å¯èƒ½æ— æ³•åŠæ—¶ç»ˆæ­¢å¼‚å¸¸å·¥ä½œæµ
- **è®¾è®¡è€ƒé‡**: ä½œä¸ºå·¥ä½œæµçš„å®‰å…¨ç½‘ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
- **æœ€ä½³å®è·µ**: åŒ…å«å¿…è¦çš„ä¿æŠ¤æ¡ä»¶ï¼Œä½†ä¸è¦è¿‡äºä¿å®ˆ

##### `exit_conditions[].action: "é€€å‡ºåŠ¨ä½œ"`
- **æ ¸å¿ƒåŠŸèƒ½**: å®šä¹‰æ»¡è¶³é€€å‡ºæ¡ä»¶æ—¶çš„å¤„ç†è¡Œä¸º
- **ä¸ºä»€ä¹ˆè¦æœ‰**: ä¸åŒé€€å‡ºåŸå› éœ€è¦ä¸åŒçš„æ¸…ç†å’ŒæŠ¥å‘Šç­–ç•¥
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²ï¼Œé¢„å®šä¹‰çš„åŠ¨ä½œç±»å‹
- **ç³»ç»Ÿé›†æˆç‚¹**:
  - `StateMachineEngine._check_global_exit_conditions()` è¿”å›å¯¹åº”çš„åŠ¨ä½œ
  - å·¥ä½œæµç»“æœç”Ÿæˆå™¨æ ¹æ®åŠ¨ä½œç±»å‹å†³å®š `WorkflowResult` å†…å®¹
  - èµ„æºæ¸…ç†ç³»ç»Ÿæ ¹æ®åŠ¨ä½œæ‰§è¡Œç›¸åº”çš„æ¸…ç†é€»è¾‘
  - æ—¥å¿—ç³»ç»Ÿè®°å½•é€€å‡ºåŸå› å’Œé‡‡å–çš„åŠ¨ä½œ
- **ä½œç”¨æ—¶æœº**: é€€å‡ºæ¡ä»¶æ»¡è¶³æ—¶ç«‹å³æ‰§è¡Œ
- **æ”¯æŒçš„åŠ¨ä½œç±»å‹**:
  - `"force_end"` - ç«‹å³ç»ˆæ­¢ï¼Œä¸ä¿å­˜ä¸­é—´ç»“æœ
  - `"save_and_end"` - ä¿å­˜å½“å‰çŠ¶æ€åç»ˆæ­¢
  - `"rollback_and_end"` - å›æ»šåˆ°å®‰å…¨çŠ¶æ€åç»ˆæ­¢
- **æ•…éšœåœºæ™¯**: åŠ¨ä½œæ‰§è¡Œå¤±è´¥å¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼
- **è®¾è®¡è€ƒé‡**: æ ¹æ®é€€å‡ºåŸå› é€‰æ‹©åˆé€‚çš„æ¸…ç†ç­–ç•¥
- **æœ€ä½³å®è·µ**: é”™è¯¯é€€å‡ºæ—¶ä¿å­˜çŠ¶æ€ï¼Œæ­£å¸¸è¶…æ—¶åˆ™ç›´æ¥ç»“æŸ

## ğŸ”„ å®Œæ•´æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            MAS-AIDER å·¥ä½œæµæ‰§è¡Œå®Œæ•´æµç¨‹                          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     1. å·¥ä½œæµå·¥å‚åˆå§‹åŒ–é˜¶æ®µ                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                    WorkflowFactory.create()                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â†“                                                                 â”‚    â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚    â”‚
â”‚  â”‚  â”ƒ                    2. YAMLé…ç½®åŠ è½½é˜¶æ®µ                          â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚              ConfigWorkflow.__init__()                  â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ name â†’ ConfigWorkflow.workflow_name                 â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ description â†’ ConfigWorkflow.get_config_summary()   â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ initial_message â†’ WorkflowFactory.get_initial_messageâ”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ max_turns â†’ StateMachineEngine.__init__()           â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ agents â†’ ConfigWorkflow.get_agent_configs()          â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ states â†’ StateMachineEngine.state_map                â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â””â”€ exit_conditions â†’ StateMachineEngine.__init__()      â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â†“                                                                 â”‚    â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚    â”‚
â”‚  â”‚  â”ƒ                    3. å·¥ä½œæµæ‰§è¡Œå‡†å¤‡é˜¶æ®µ                        â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚             BaseWorkflow.execute()                      â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ agents â†’ EnvironmentService.setup_workspace()      â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ agents â†’ AgentService.create_agents_for_workflow()  â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â””â”€ initial_message â†’ WorkflowContext.initial_message   â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â†“                                                                 â”‚    â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚    â”‚
â”‚  â”‚  â”ƒ                    4. çŠ¶æ€æœºæ‰§è¡Œå¾ªç¯                            â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚          StateMachineEngine.execute()                   â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ states[].start â†’ _get_start_state()                â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ exit_conditions â†’ _check_global_exit_conditions()   â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ max_turns â†’ å…¨å±€çŠ¶æ€ turn_count æ£€æŸ¥                â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ states[].name â†’ state_map å­—å…¸é”®                    â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ states[].agent â†’ AgentService.get_agent_for_workflowâ”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ states[].prompt â†’ _render_prompt() æ¨¡æ¿æ¸²æŸ“         â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”‚  â””â”€ initial_message â†’ {{initial_message}} æ›¿æ¢       â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ transitions[].condition â†’ ConditionEvaluator.evaluateâ”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â””â”€ transitions[].to â†’ ä¸‹ä¸€çŠ¶æ€ç›®æ ‡                     â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â†“                                                                 â”‚    â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚    â”‚
â”‚  â”‚  â”ƒ                    5. Agentæ‰§è¡Œé˜¶æ®µ                             â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚         AgentService.get_agent_for_workflow()           â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ agents[].name â†’ å·¥ä½œåŒºç›®å½•æ˜ å°„                      â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â””â”€ agents[].type â†’ Agent å®ä¾‹åŒ–å‚æ•°ï¼ˆé€‰æ‹©Coderç±»å‹ï¼‰   â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ â”‚    â”‚
â”‚  â”‚  â”‚  â†“                                                             â”‚    â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚    â”‚
â”‚  â”‚  â”ƒ                    6. ç»“æœç”Ÿæˆå’Œç»Ÿè®¡                           â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚             WorkflowResult æ„å»º                         â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ agents[].name â†’ agents_used åˆ—è¡¨                   â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ states æ‰§è¡Œå†å² â†’ total_turns ç»Ÿè®¡                â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â”œâ”€ final_content â†’ å·¥ä½œåŒºè¾“å‡ºæ”¶é›†                     â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â”‚  â””â”€ execution_history â†’ metadata è®°å½•                 â”‚   â”ƒ â”‚    â”‚
â”‚  â”‚  â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å­—æ®µä½¿ç”¨ä½ç½®è¯¦ç»†æ˜ å°„ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ ¹çº§å­—æ®µæ˜ å°„ï¼š
â”œâ”€â”€ name â†’ å·¥ä½œåŒºç›®å½•: workspaces/{name}/
â”œâ”€â”€ description â†’ ConfigWorkflow.get_config_summary()
â”œâ”€â”€ initial_message â†’ WorkflowContext.initial_message
â””â”€â”€ max_turns â†’ StateMachineEngine.max_turns

Agentå­—æ®µæ˜ å°„ï¼š
â”œâ”€â”€ agents[].name â†’ AgentService.create_agents_for_workflow() + WorkflowResult.agents_used
â””â”€â”€ agents[].type â†’ AiderAgentFactory.create_coder() (é€‰æ‹©Coderç±»å‹)

çŠ¶æ€æœºå­—æ®µæ˜ å°„ï¼š
â”œâ”€â”€ states[].name â†’ StateMachineEngine.state_map[key]
â”œâ”€â”€ states[].agent â†’ AgentService.get_agent_for_workflow()
â”œâ”€â”€ states[].start â†’ StateMachineEngine._get_start_state()
â”œâ”€â”€ states[].prompt â†’ StateMachineEngine._render_prompt()
â”œâ”€â”€ transitions[].condition â†’ ConditionEvaluator.evaluate()
â”œâ”€â”€ transitions[].to â†’ StateMachineEngine._evaluate_transitions()
â”œâ”€â”€ exit_conditions[].condition â†’ StateMachineEngine._check_global_exit_conditions()
â””â”€â”€ exit_conditions[].action â†’ WorkflowResult ç”Ÿæˆç­–ç•¥

æ¨¡æ¿å˜é‡æ˜ å°„ï¼š
â”œâ”€â”€ {{initial_message}} â†’ WorkflowContext.initial_message
â””â”€â”€ {{turn_count}} â†’ global_state["turn_count"]

å†³ç­–å­—æ®µæ˜ å°„ï¼š
â”œâ”€â”€ needs_more_info â†’ transitions[].condition è¯„ä¼°
â”œâ”€â”€ content_complete â†’ transitions[].condition è¯„ä¼°
â”œâ”€â”€ satisfaction_score â†’ transitions[].condition è¯„ä¼°
â””â”€â”€ quality_confidence â†’ transitions[].condition è¯„ä¼°
```

## â° å­—æ®µä½¿ç”¨æ—¶é—´çº¿

### å·¥ä½œæµç”Ÿå‘½å‘¨æœŸ

#### 1. **é…ç½®åŠ è½½é˜¶æ®µ** (ConfigWorkflow.__init__)
- âœ… `name` - è®¾ç½® workflow_name
- âœ… `description` - å­˜å‚¨é…ç½®æ‘˜è¦
- âœ… `initial_message` - ç¼“å­˜ä¾›åç»­ä½¿ç”¨
- âœ… `max_turns` - åˆå§‹åŒ–çŠ¶æ€æœºå¼•æ“
- âœ… `agents` - éªŒè¯ Agent å®šä¹‰
- âœ… `states` - æ„å»ºçŠ¶æ€æœºæ˜ å°„
- âœ… `exit_conditions` - å‡†å¤‡å…¨å±€æ£€æŸ¥

#### 2. **å·¥ä½œæµåˆå§‹åŒ–é˜¶æ®µ** (BaseWorkflow.execute)
- âœ… `agents` - åˆ›å»º Agent å®ä¾‹
- âœ… `name` - åˆ›å»ºå·¥ä½œåŒºç›®å½•
- âœ… `initial_message` - è®¾ç½®ä¸Šä¸‹æ–‡

#### 3. **çŠ¶æ€æœºåˆå§‹åŒ–é˜¶æ®µ** (StateMachineEngine.__init__)
- âœ… `states` - æ„å»ºçŠ¶æ€æ˜ å°„è¡¨
- âœ… `max_turns` - è®¾ç½®å¾ªç¯é™åˆ¶
- âœ… `exit_conditions` - åˆå§‹åŒ–é€€å‡ºæ£€æŸ¥

#### 4. **æ‰§è¡Œå‡†å¤‡é˜¶æ®µ** (StateMachineEngine.execute)
- âœ… `states[].start` - ç¡®å®šèµ·å§‹çŠ¶æ€
- âœ… å…¨å±€çŠ¶æ€åˆå§‹åŒ– (turn_count, start_time ç­‰)

#### 5. **çŠ¶æ€æ‰§è¡Œé˜¶æ®µ** (æ¯æ¬¡å¾ªç¯)
- âœ… `states[].agent` - é€‰æ‹©æ‰§è¡Œ Agent
- âœ… `states[].prompt` - æ¸²æŸ“ä»»åŠ¡æŒ‡ä»¤
- âœ… Agent æ‰§è¡Œä»»åŠ¡
- âœ… è§£æ Agent å“åº”ä¸­çš„ decisions

#### 6. **çŠ¶æ€è½¬ç§»é˜¶æ®µ**
- âœ… `states[].transitions[].condition` - è¯„ä¼°è½¬ç§»æ¡ä»¶
- âœ… `states[].transitions[].to` - ç¡®å®šä¸‹ä¸€çŠ¶æ€
- âœ… `exit_conditions[].condition` - æ£€æŸ¥å…¨å±€é€€å‡º

#### 7. **å·¥ä½œæµç»“æŸé˜¶æ®µ**
- âœ… `name` - æ ‡è¯†å·¥ä½œæµç±»å‹
- âœ… `agents` - ç»Ÿè®¡ä½¿ç”¨çš„ Agent
- âœ… `max_turns` - éªŒè¯æ‰§è¡Œé™åˆ¶

## ğŸ“Š å­—æ®µä¾èµ–å…³ç³»

### å¿…é¡»å­—æ®µ
- `name` - å·¥ä½œæµæ ‡è¯†
- `agents` - è‡³å°‘ä¸€ä¸ª Agent
- `states` - è‡³å°‘ä¸€ä¸ªçŠ¶æ€
- `states[].name` - çŠ¶æ€æ ‡è¯†
- `states[].agent` - æ‰§è¡Œ Agent
- è‡³å°‘ä¸€ä¸ªçŠ¶æ€æœ‰ `start: true`

### å¯é€‰å­—æ®µ
- `description` - é»˜è®¤ç©ºå­—ç¬¦ä¸²
- `initial_message` - é»˜è®¤ "Start {workflow_name} workflow"
- `max_turns` - é»˜è®¤ 10
- `exit_conditions` - é»˜è®¤ç©ºæ•°ç»„
- `states[].start` - é»˜è®¤ false
- `states[].prompt` - é»˜è®¤ç©ºå­—ç¬¦ä¸²
- `states[].transitions` - é»˜è®¤è½¬ç§»åˆ° "END"

### å­—æ®µçº¦æŸè§„åˆ™

#### å”¯ä¸€æ€§çº¦æŸ
- `name` åœ¨æ‰€æœ‰å·¥ä½œæµä¸­å¿…é¡»å”¯ä¸€
- `agents[].name` åœ¨å½“å‰å·¥ä½œæµä¸­å¿…é¡»å”¯ä¸€
- `states[].name` åœ¨å½“å‰å·¥ä½œæµä¸­å¿…é¡»å”¯ä¸€
- åªæœ‰ä¸€ä¸ª `states[].start` å¯ä»¥ä¸º `true`

#### å¼•ç”¨å®Œæ•´æ€§çº¦æŸ
- `states[].agent` å¿…é¡»å¼•ç”¨ `agents[].name` ä¸­å­˜åœ¨çš„ Agent
- `transitions[].to` å¿…é¡»æ˜¯æœ‰æ•ˆçŠ¶æ€åæˆ–ç‰¹æ®Šå€¼ `"END"`

#### è¯­æ³•çº¦æŸ
- `name`, `agents[].name`, `states[].name` åªèƒ½ä½¿ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- `condition` å­—æ®µå¿…é¡»æ˜¯æœ‰æ•ˆçš„å¸ƒå°”è¡¨è¾¾å¼
- `max_turns` å¿…é¡»æ˜¯æ­£æ•´æ•°

### ğŸ”— å­—æ®µé—´ä¾èµ–å…³ç³»è¯¦è§£

#### æ•°æ®æµä¾èµ–é“¾
```
initial_message (æ ¹çº§)
    â†“ (æ¨¡æ¿æ›¿æ¢)
states[].prompt â†’ {{initial_message}}
    â†“ (ä¸Šä¸‹æ–‡ä¼ é€’)
WorkflowContext.initial_message
    â†“ (è¿è¡Œæ—¶æ¸²æŸ“)
StateMachineEngine._render_prompt()
```

#### çŠ¶æ€æœºä¾èµ–é“¾
```
agents[].name (å®šä¹‰)
    â†“ (å¼•ç”¨éªŒè¯)
states[].agent (ä½¿ç”¨)
    â†“ (å®ä¾‹æŸ¥æ‰¾)
AgentService.get_agent_for_workflow()
    â†“ (ç›®å½•æ˜ å°„)
EnvironmentService.setup_workspace_for_workflow()
```

#### æ¡ä»¶è¯„ä¼°ä¾èµ–é“¾
```
states[].transitions[].condition (é…ç½®)
    â†“ (å˜é‡è§£æ)
Agent å“åº”ä¸­çš„ decisions å­—æ®µ (è¿è¡Œæ—¶)
    â†“ (è¡¨è¾¾å¼è®¡ç®—)
ConditionEvaluator.evaluate()
    â†“ (ç»“æœåˆ¤æ–­)
StateMachineEngine._evaluate_transitions()
```

#### å…¨å±€çº¦æŸä¾èµ–é“¾
```
max_turns (é…ç½®)
    â†“ (é»˜è®¤ç”Ÿæˆ)
exit_conditions: [{"condition": "turn_count >= max_turns"}] (éšå¼)
    â†“ (è¿è¡Œæ—¶æ£€æŸ¥)
StateMachineEngine._check_global_exit_conditions()
    â†“ (åŠ¨ä½œæ‰§è¡Œ)
å·¥ä½œæµç»ˆæ­¢æˆ–ç»§ç»­
```

### âš ï¸ å¸¸è§é…ç½®é”™è¯¯æ¨¡å¼

#### 1. å¼•ç”¨å®Œæ•´æ€§é”™è¯¯
```yaml
# âŒ é”™è¯¯ï¼šagent ä¸å­˜åœ¨
states:
  - name: "task"
    agent: "non_existent_agent"  # æœªåœ¨ agents ä¸­å®šä¹‰
```

#### 2. å”¯ä¸€æ€§çº¦æŸè¿å
```yaml
# âŒ é”™è¯¯ï¼šé‡å¤åç§°
agents:
  - name: "client"
  - name: "client"  # è¿åå”¯ä¸€æ€§
```

#### 3. èµ·å§‹çŠ¶æ€é…ç½®é”™è¯¯
```yaml
# âŒ é”™è¯¯ï¼šæ²¡æœ‰èµ·å§‹çŠ¶æ€
states:
  - name: "state1"  # ç¼ºå°‘ start: true

# âŒ é”™è¯¯ï¼šå¤šä¸ªèµ·å§‹çŠ¶æ€
states:
  - name: "state1"
    start: true
  - name: "state2"
    start: true  # è¿åå•ä¸€æ€§
```

#### 4. æ¡ä»¶è¡¨è¾¾å¼è¯­æ³•é”™è¯¯
```yaml
# âŒ é”™è¯¯ï¼šæ— æ•ˆè¯­æ³•
transitions:
  - to: "next"
    condition: "invalid syntax &&&"  # è¯­æ³•é”™è¯¯
```

### âœ… é…ç½®éªŒè¯æ¸…å•

**å¿…é¡»æ£€æŸ¥é¡¹:**
- [ ] `name` å­—æ®µå­˜åœ¨ä¸”å”¯ä¸€
- [ ] `agents` æ•°ç»„ä¸ä¸ºç©º
- [ ] æ¯ä¸ª `agents[].name` å”¯ä¸€ä¸”ä¸ä¸ºç©º
- [ ] `states` æ•°ç»„ä¸ä¸ºç©º
- [ ] æ¯ä¸ª `states[].name` å”¯ä¸€ä¸”ä¸ä¸ºç©º
- [ ] åªæœ‰ä¸€ä¸ªçŠ¶æ€çš„ `start: true`
- [ ] æ‰€æœ‰ `states[].agent` åœ¨ `agents` ä¸­å­˜åœ¨
- [ ] æ‰€æœ‰ `transitions[].to` æŒ‡å‘æœ‰æ•ˆçŠ¶æ€æˆ– "END"
- [ ] æ‰€æœ‰ `condition` å­—æ®µè¯­æ³•æ­£ç¡®
- [ ] `max_turns` æ˜¯æ­£æ•´æ•°ï¼ˆå¦‚æœæŒ‡å®šï¼‰

**æ¨èæ£€æŸ¥é¡¹:**
- [ ] `description` æä¾›äº†æœ‰æ„ä¹‰çš„è¯´æ˜
- [ ] `initial_message` æ¸…æ™°è¡¨è¾¾äº†å·¥ä½œæµç›®æ ‡
- [ ] `exit_conditions` åŒ…å«äº†å¿…è¦çš„ä¿æŠ¤æ¡ä»¶
- [ ] æ‰€æœ‰çŠ¶æ€éƒ½æœ‰åˆç†çš„è½¬ç§»é€»è¾‘

## ğŸ” è°ƒè¯•å’Œæ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. "Agent directory not found"
- **åŸå› **: `states[].agent` ä¸åœ¨ `agents` æ•°ç»„ä¸­
- **æ£€æŸ¥**: éªŒè¯æ‰€æœ‰çŠ¶æ€çš„ agent å­—æ®µæ˜¯å¦æ­£ç¡®

#### 2. "Missing key api_base"
- **åŸå› **: ç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼ŒOmegaConf æ’å€¼å¤±è´¥
- **æ£€æŸ¥**: ç¡®ä¿ .env æ–‡ä»¶å­˜åœ¨ä¸”ç¯å¢ƒå˜é‡æ­£ç¡®

#### 3. "State not found"
- **åŸå› **: `transitions[].to` æŒ‡å‘ä¸å­˜åœ¨çš„çŠ¶æ€
- **æ£€æŸ¥**: éªŒè¯æ‰€æœ‰è½¬ç§»ç›®æ ‡çŠ¶æ€éƒ½å­˜åœ¨

#### 4. æ— é™å¾ªç¯
- **åŸå› **: è½¬ç§»æ¡ä»¶æ°¸è¿œä¸æ»¡è¶³
- **æ£€æŸ¥**: éªŒè¯ conditions è¡¨è¾¾å¼å’Œ decisions å­—æ®µ

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**: æ£€æŸ¥ `aider.verbose_logging`
2. **éªŒè¯é…ç½®**: ä½¿ç”¨ `ConfigWorkflow.get_config_summary()`
3. **æ£€æŸ¥çŠ¶æ€æœº**: æŸ¥çœ‹ `StateMachineEngine.state_map`
4. **ç›‘æ§æ¡ä»¶**: æŸ¥çœ‹ `ConditionEvaluator` çš„è¯„ä¼°ç»“æœ

---

*æ–‡æ¡£ç‰ˆæœ¬: 2.0 - æ·±åº¦æŠ€æœ¯è§„èŒƒç‰ˆ*
*æœ€åæ›´æ–°: 2025-12-05*
*å¯¹åº” MAS-AIDER ç‰ˆæœ¬: 1.0*
*æ–‡æ¡£ç»´æŠ¤è€…: MAS-AIDER å¼€å‘å›¢é˜Ÿ*

## ğŸ“š ç›¸å…³èµ„æº

- [å·¥ä½œæµé…ç½®ç¤ºä¾‹](hulatang.yaml) - ç”²æ–¹ä¹™æ–¹åä½œå·¥ä½œæµ
- [åä½œå·¥ä½œæµé…ç½®](collaboration.yaml) - æ¶æ„å¸ˆå¼€å‘è€…åä½œå·¥ä½œæµ
- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](../README.md) - MAS-AIDER æ•´ä½“æ¶æ„è¯´æ˜
- [API å‚è€ƒ](../core/) - æ ¸å¿ƒç»„ä»¶æ¥å£æ–‡æ¡£

## ğŸ¤ è´¡çŒ®æŒ‡å—

å¦‚éœ€æ·»åŠ æ–°çš„å­—æ®µæˆ–ä¿®æ”¹ç°æœ‰å­—æ®µçš„è¡Œä¸ºï¼Œè¯·ï¼š

1. æ›´æ–°ç›¸åº”çš„ YAML é…ç½®æ–‡ä»¶
2. ä¿®æ”¹ç›¸å…³ç±»çš„å®ç°ä»£ç 
3. æ›´æ–°æœ¬æŠ€æœ¯è§„èŒƒæ–‡æ¡£
4. æ·»åŠ ç›¸åº”çš„å•å…ƒæµ‹è¯•
5. æ›´æ–°ç‰ˆæœ¬å·å’Œæ›´æ–°æ—¥æœŸ

---

**MAS-AIDER** - å¤š Agent ç³»ç»Ÿæ™ºèƒ½åŒ–å¼€å‘ç¯å¢ƒ
